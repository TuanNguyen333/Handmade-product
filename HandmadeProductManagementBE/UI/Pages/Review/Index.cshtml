@page

@model UI.Pages.Review.IndexModel
@{
	ViewData["Title"] = "Reviews";
}

<h1 class="text-4xl font-bold mb-4 text-center text-red-600">Reviews</h1>

<div class="space-y-4">
    @foreach (var review in Model.Reviews)
    {
        <div class="border border-gray-300 rounded-lg p-4 bg-white shadow-md">
            <div class="flex flex-col">
                <span class="font-semibold">@(Model.Users.FirstOrDefault(user => user.Id == review.UserId)?.UserName ?? "Unknown User")</span>
                <span class="text-gray-500 text-sm">@review.Date?.ToString("g")</span>
                <div class="flex items-center">
                    @for (int i = 1; i <= 5; i++)
                    {
                        <svg class="h-5 w-5 @(i <= review.Rating ? "text-yellow-500" : "text-gray-300")" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 .587l3.668 7.568 8.235 1.199-5.964 5.222L19.339 24 12 20.812 4.661 24l1.331-9.424-5.964-5.222 8.235-1.199L12 .587z" />
                        </svg>
                    }
                </div>
                <p class="mt-2">@review.Content</p>
            </div>

            <!-- Reply Section with Shop ID -->
            <div class="relative ml-4 bg-gray-50 border border-gray-300 rounded-lg p-2 mt-4">
                <div class="text-gray-700 font-semibold mb-2">@(Model.Shops.FirstOrDefault(shop => shop.Id == review.Reply?.ShopId)?.Name ?? "Unknown Shop")</div>

                @if (review.Reply != null)
                {
                    <p>@review.Reply.Content</p>
                }
                else
                {
                    <form method="post" asp-page="CreateReply" asp-route-reviewId="@review.Id" class="mt-2">
                        <textarea name="content" required class="border border-gray-300 rounded-lg p-2 w-full mb-2" placeholder="Write your reply here..."></textarea>
                        <button type="submit" class="bg-blue-500 text-white rounded-lg px-4 py-2">Reply</button>
                    </form>
                }
            </div>

            <!-- Action Links -->
            <div class="flex justify-end mt-4">
                <a class="text-blue-600 hover:text-blue-800" asp-page="Details" asp-route-reviewId="@review.Id">Details</a> |
                <a class="text-blue-600 hover:text-blue-800" asp-page="Edit" asp-route-reviewId="@review.Id">Edit</a> |
                <a class="text-red-600 hover:text-red-800" asp-page="SoftDelete" asp-route-reviewId="@review.Id">Soft Delete</a>
            </div>
        </div>
    }
</div>

@if (Model.TotalPages > 1)
{
    <nav class="mt-4">
        <ul class="flex justify-center space-x-2">
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(Model.PageNumber == i ? "active" : "")">
                    <a class="px-4 py-2 border border-gray-300 rounded-md" class="page-link" asp-page="Index" asp-route-pageNumber="@i">@i</a>
                </li>
            }
        </ul>
    </nav>
}